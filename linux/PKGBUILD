# Maintainer: MrGraf <your-email@example.com>
pkgname=notebox
pkgver=1.0.0
pkgrel=1
pkgdesc="Markdown notes app with Python backend and React frontend"
arch=('x86_64')
url="https://github.com/MrGrafGitHub/notebox"
license=('MIT')
depends=('nodejs' 'npm' 'python' 'python-pip' 'python-flask' 'python-flask-cors')
makedepends=('npm' 'nodejs' 'python-pip')
source=(
  "../backend"
  "../frontend"
  "install.sh"
  "notebox.desktop"
  "icon.png"
)
noextract=("../backend" "../frontend")  # не распаковывать, т.к. локальные папки

build() {
  cd "$srcdir/frontend"
  npm install
  npm run build
}

package() {
  # Создаем нужные папки в пакете
  mkdir -p "$pkgdir/opt/notebox/backend"
  mkdir -p "$pkgdir/opt/notebox/frontend"

  # Копируем backend без кешей и базы (чтобы база была локальная, не в пакете)
  rsync -a --exclude='__pycache__' --exclude='notes.db' "$srcdir/backend/" "$pkgdir/opt/notebox/backend/"

  # Копируем готовый билд фронтенда (dist или build — смотря что у тебя)
  cp -r "$srcdir/frontend/dist" "$pkgdir/opt/notebox/frontend/"

  # Копируем скрипты и desktop-файл
  install -Dm755 "$srcdir/install.sh" "$pkgdir/usr/bin/notebox-install.sh"
  install -Dm644 "$srcdir/notebox.desktop" "$pkgdir/usr/share/applications/notebox.desktop"
  install -Dm644 "$srcdir/icon.png" "$pkgdir/usr/share/pixmaps/notebox.png"
}
