pkgname=notebox
pkgver=1.0.0
pkgrel=1
pkgdesc="Markdown notes app with Flask backend and Vite+React frontend"
arch=('x86_64')
url="https://github.com/MrGrafGitHub/notebox"
license=('MIT')
depends=('nodejs' 'npm' 'python' 'python-flask' 'python-flask-cors' 'sqlcipher')
makedepends=('npm' 'python-pip')
source=()
md5sums=()

build() {
  cd "$srcdir/frontend"
  npm install
  npm run build
}

package() {
  cd "$srcdir"
  
  # Создаём папки
  mkdir -p "$pkgdir/opt/notebox/backend"
  mkdir -p "$pkgdir/opt/notebox/frontend"

  # Копируем backend (исключая __pycache__ и notes.db — БД можно отдельным файлом держать)
  rsync -av --exclude='__pycache__' --exclude='notes.db' backend/ "$pkgdir/opt/notebox/backend/"

  # Копируем frontend сборку (vite обычно кладёт сборку в dist/)
  cp -r frontend/dist "$pkgdir/opt/notebox/frontend/"

  # Копируем файлы для запуска
  install -Dm755 linux/install.sh "$pkgdir/usr/bin/notebox-install.sh"
  install -Dm644 linux/notebox.desktop "$pkgdir/usr/share/applications/notebox.desktop"
  install -Dm644 linux/icon.png "$pkgdir/usr/share/pixmaps/notebox.png"
}
